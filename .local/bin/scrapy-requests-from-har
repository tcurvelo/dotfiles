#!/usr/bin/env python3

import click
import json


@click.command()
@click.argument("archive")
def main(archive):
    with open(archive) as f:
        log = json.load(f)["log"]
        for index, entry in enumerate(log["entries"]):
            print_scrapy_request(
                entry["request"]["url"],
                entry["request"]["method"],
                callback_name=f"parse_{index}",
            )


def print_scrapy_request(url, method, callback_name):
    print(
        f"scrapy.Request(\n"
        + f'    url="{url}",\n'
        + (f'    method="{method}",\n' if method == "POST" else "")
        + f"    callback=self.{callback_name},\n"
        f")\n"
    )


if __name__ == "__main__":
    main()
